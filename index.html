<!DOCTYPE html>

<!--[if gt IE 9]><!--> <html lang="en"> <!--<![endif]-->

<head>

  <meta charset="utf-8">

  <title>Audacity Engine</title>

  <meta name="description" content="">
  <meta name="author" content="">
  <meta name="robots" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0">

  <!-- Favicons (just the basics for now, check out http://realfavicongenerator.net/ for all available) -->
  <link rel="shortcut icon" href="assets/img/favicon.png">
  <link rel="icon" type="image/png" href="assets/img/favicon.png" sizes="32x32">
          <link rel="stylesheet" href="assets/css/bootstrap.min.css">

  <script src="https://unpkg.com/3d-force-graph"></script>
          <script src="assets/js/core/jquery.min.js"></script>
  <!--<script src="../../dist/3d-force-graph.js"></script>-->

  <style>
  .fullscreen {
  position: fixed;
  top: 0;
  left: 0;
  bottom: 0;
  right: 0;
  overflow: auto;
  background: black; /* Just to visualize the extent */
}
 </style>
</head>

<body>

  <div class="row fullscreen">
  <div id="3d-graph" class="fullscreen"></div>
  </div>

  <script>
    // Random tree
    const N = 80;
    const gData = {
      nodes: [...Array(N).keys()].map(i => ({ id: i })),
      links: [...Array(N).keys()]
        .filter(id => id)
        .map(id => ({
          source: id,
          target: Math.round(Math.random() * (id-1))
        }))
    };

    // cross-link node objects
    gData.links.forEach(link => {
      const a = gData.nodes[link.source];
      const b = gData.nodes[link.target];
      !a.neighbors && (a.neighbors = []);
      !b.neighbors && (b.neighbors = []);
      a.neighbors.push(b);
      b.neighbors.push(a);

      !a.links && (a.links = []);
      !b.links && (b.links = []);
      a.links.push(link);
      b.links.push(link);
    });

    const highlightNodes = new Set();
    const highlightLinks = new Set();
    let hoverNode = null;

    const Graph = ForceGraph3D()
      (document.getElementById('3d-graph'))

  .jsonUrl('https://betterme.ai/audacitycommons/audacityengine/data/data_20201201.json')
  .nodeLabel('id')

    // .nodeAutoColorBy('color')

//If Node is not highlighted or there is no hover on Node, then default value of node color is taken
 .nodeColor(node => highlightNodes.has(node) ? node === hoverNode ? 'rgba(255,160,0,0.8)' : 'rgba(255,160,0,0.8)' : node.color)
    // .nodeColor('color')
        .linkWidth(link => highlightLinks.has(link) ? 4 : 1)
        .linkDirectionalParticles(link => highlightLinks.has(link) ? 4 : 0)
        .linkDirectionalParticleWidth(4)
        .onNodeHover(node => {
          // no state change
          if ((!node && !highlightNodes.size) || (node && hoverNode === node)) return;

          highlightNodes.clear();
          highlightLinks.clear();
          if (node) {
            highlightNodes.add(node);
            if (node.neighbours)
            node.neighbors.forEach(neighbor => highlightNodes.add(neighbor));
            if (node.links)
            node.links.forEach(link => highlightLinks.add(link));
          }

          hoverNode = node || null;

          updateHighlight();
        })
        .onNodeClick(node => {
         // Aim at node from outside it
         const distance = 40;
         const distRatio = 1 + distance/Math.hypot(node.x, node.y, node.z);

         Graph.cameraPosition(
           { x: node.x * distRatio, y: node.y * distRatio, z: node.z * distRatio }, // new position
           node, // lookAt ({ x, y, z })
           3000  // ms transition duration
         );


       })
       .onNodeRightClick(node => {
         window.open(
              node.url,
              '_blank' // <- This is what makes it open in a new window.
            );
                   })
        .onLinkHover(link => {
          highlightNodes.clear();
          highlightLinks.clear();

          if (link) {
            highlightLinks.add(link);
            highlightNodes.add(link.source);
            highlightNodes.add(link.target);
          }

          updateHighlight();
        });

    function updateHighlight() {
      // trigger update of highlighted objects in scene
      Graph
        .nodeColor(Graph.nodeColor())
        .linkWidth(Graph.linkWidth())
        .linkDirectionalParticles(Graph.linkDirectionalParticles());
    }

    // fit to canvas when engine stops
// Graph.onEngineStop(() => Graph.zoomToFit(400));
  </script>
</body>
</html>
